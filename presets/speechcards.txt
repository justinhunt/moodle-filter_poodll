{"name":"speechcards","key":"speechcards","version":"1.0.2","instructions":"Speechcards","showatto":"1","showplayers":"0","requirecss":"//fastcdn.org/Glide.js/2.0.4/css/glide.core.min.css","requirejs":"/filter/poodll/amd/src/speech_poodll.js","shim":"","defaults":"language=en|ja","amd":"1","body":"<div id=\"@@AUTOID@@_glide\" class=\"glide\">\n\n    <div class=\"glide__arrows speechcards_toprow\">\n        <button class=\"glide__arrow prev btn btn-success\" data-glide-dir=\"<\">prev</button>\n        <div id='@@AUTOID@@_whatheard' class='speechcards_whatheard'>........</div>\n        <button class=\"glide__arrow next btn btn-success\" data-glide-dir=\">\">Next</button>\n    </div>\n \n    <div class=\"glide__wrapper\">","bodyend":"    </div>\n\n","script":"//get the audio device listening\n//just once trigger the permissions dialog, if needed\nif(!('filter_poodll_navigator_checked' in window)){\n   window.filter_poodll_navigator_checked=true;\n   navigator.mediaDevices.getUserMedia({\"audio\": true});\n}\n\nvar whatheard =$('#' + @@AUTOID@@ + '_whatheard');\nstt = requiredjs_speechcards;\nstt.init(@@language@@);\nvar current=0;\nvar items =[];\n\nfunction cleanText(text){\n  return text.toLowerCase().replace(/[^\\w\\s]|_/g, \"\").replace(/\\s+/g, \" \").trim();\n}\n\n\n$(\"#\" + @@AUTOID@@ + \"_glide li\").each(function( index ) {\n  items[index]= cleanText($( this ).text());\n});\n\n$(\"#\" + @@AUTOID@@ + \"_glide ul\").addClass('glide__track');\n$(\"#\" + @@AUTOID@@ + \"_glide li\").addClass('glide__slide');\n$(\"#\" + @@AUTOID@@ + \"_glide li\").wrapInner(\"<div class='box'></box>\");\n\n$.getScript('https://fastcdn.org/Glide.js/2.0.4/glide.min.js').done(function(){\nvar glider;\nfunction setCurrent(index){\n   // stt.stop();\n//console.log('current:' + items[index-1]);\n    stt.onfinalspeechcapture=function(speechtext){\n      whatheard.text(speechtext);\n   \n      if(cleanText(speechtext)==items[index-1]){\n         whatheard.addClass('speechcards_gotit');\n         setTimeout(function(){\n         whatheard.removeClass('speechcards_gotit');\n         whatheard.text('........');\n         glider.go('>');\n         },700);\n      };\n}\n    stt.start();\n}\n glider = $(\"#\" + @@AUTOID@@ + \"_glide\").glide({\n        type: \"carousel\",\n        autoplay: false,\n        afterTransition: function(data){setCurrent(data);},\n        afterInit: function(data){setCurrent(data);},\n    }).data('glide_api');\n\n});\n\n\n ","style":".box {\n    text-align: center;\n    color: #fff;\n    width: 50%;\n    background: blue;\n    padding: 54px 18px;\n    font-size: 2em;\n    margin-left: 15px;\n    margin-right: 15px;\n    border-radius: 6px;\n}\n.speechcards_toprow{\n   display: flex;\n}\n.speechcards_whatheard{\n width: 400px;\n border: dotted 1px;\n border-color: green;\n text-align: center;\n margin: 1px;\n}\n.speechcards_gotit{\n color: white;\n background-color: green;\n}","dataset":"","datasetvars":"","alternate":"","alternateend":""}